# base image
# FROM registry.cn-hangzhou.aliyuncs.com/dtunion/morsebase:vsmodel1
#FROM registry.cn-hangzhou.aliyuncs.com/dtunion/morsetfe:v2.4
FROM registry.cn-hangzhou.aliyuncs.com/dtunion/morsetfe:v3.16
#FROM continuumio/miniconda3


# add appliction code
ADD . /app

RUN mkdir -p /app/logs
RUN mkdir -p /app/var
RUN mkdir -p /app/tmp
RUN mkdir -p /app/file
RUN mkdir -p /app/conf
RUN mkdir -p /app/conf/parser
RUN rm -rf /app/tfe_keeper/tfe_keeper.py




# requirements
#RUN pip install -r /app/conf/requirements.txt
RUN pip install coverage -i https://mirrors.aliyun.com/pypi/simple/
RUN pip install xmlrunner -i https://mirrors.aliyun.com/pypi/simple/
RUN pip install mock -i https://mirrors.aliyun.com/pypi/simple/
RUN apt-get install curl -y



# nginx
RUN mkdir -p /app/conf
# ADD ./conf/dataleaguelocal_nginx.conf /app/conf
ADD ./conf/docker-entry-tfe.sh  /app/
ADD ./conf/tfe_uwsgi.ini  /app/conf

ENTRYPOINT ["/app/docker-entry-tfe.sh"]

